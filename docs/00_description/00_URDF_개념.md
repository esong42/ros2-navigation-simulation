# URDF

### URDF 란

URDF(Unified Robot Description Format)는 로봇의 정보를 정의하는 XML 형식의 파일이다. 로봇의 원, 타원, 직사각형 따위의 기하학적 모델, 관절, 센서 등의 정보를 정의한다.

로봇을 구성하는 하나의 구성요소를 링크(link)라 부르고, 동적인 움직임을 위해 링크와 링크를 연결하는 연결부를 조인트(joint)라 부른다. 링크와 조인트의 조합을 통해 원하는 형태의 로봇을 udrf를 통해 표현할 수 있다.

모델링한 정보는 RViz(Ros vizualization), Gazebo와 같은 시각화 프로그램을 사용해서 로봇을 확인하고 시뮬레이션 해볼 수 있다.
<br><br>

---

### 사용하는 각도와 좌표계

**라디안**

URDF에서 사용하는 각도는 60분법이 아니라 라디안을 사용한다.<br><br>

**좌표계**

URDF에서 좌표계의 표현은 직교 좌표계와 오일러 각 두 가지로 한다:

- **직교 좌표계 (xyz)**
    - 직교 좌표계를 통해 3차원 공간에 로봇이 어디에 있는지 알 수 있다.
    - 직교 좌표계만으로 로봇을 표현하면 로봇이 어느 방향을 향하고 있는지 알 수 없다.
    - 단위는 미터이다.
- **오일러 각 (rpy, roll pitch yaw)**
    - x축에 대해서 회전(roll), y축에 대해서 회전(pitch), z축에 대해서 회전(yaw)을 통해 로봇을 표현
    - 오일러 각을 사용하여 로봇을 표현하면 3차원 공간에서 로봇을 어느 방향을 향하고 있는지 알 수 있다.
    - 라디안으로 정의한다.
    

좌표는 직교 좌표계를 통해 로봇의 위치를 3차원 공간 상에서 표현을 하고, 오일러 각을 통해 로봇의 방향을 표현한다. 
<br><br>

---

### link

링크는 강체라 생각하면 된다. 물리에서 정의하는 강체는 외부의 힘을 받아도 그 크기와 모양이 변하지 않는 이상적인 고체를 말한다. 예를 들어, 자동차 로봇을 떠올리면 차체와 바퀴 모두 강체이며, 도로도 강체로써 모두 link로 설명된다.<br><br>

**링크의 세 가지 속성**

링크는 아래의 세 가지 속성을 가진다:

- **inertial**: 물리적 속성 (관성 및 질량 정보,  정의하지 않을 경우 디폴트 값으로 0 mass와 0 inertia로 생성된다)
- **visual**: 시각적 속성 (기하 정보, 위치, 색상 등)
- **collision**: 충돌 속성

위의 세 가지 속성은 필수 속성은 아니다. 하지만 inertial의 경우에는 정의하지 않을 경우 디폴트 값(0 mass, 0 inertia)으로 정의된다.<br><br>

**원점 좌표(origin)**

로봇의 좌표 표현은 직교 좌표계를 통해 로봇의 위치를 3차원 공간 상에서 표현하고, 오일러 각을 통해 로봇의 방향을 표현한다.

- **xyz**: 직교 좌표계 값
- **rpy**: 오일러 각 값(roll, pitch, yaw)

링크는 크게 물리적 속성(inertial), 시각화 속성(visual), 충돌 속성(collision)을 가지며, 각각 다른 위치 값을 가질 수 있다.<br><br>

**형상(geometry)**

링크의 형태를 정의하는 태그이다.

- **box**
    
    세 변(가로, 세로, 높이)을 정의
    
    ```
    <box size=”0.6 0.1 0.2”/>
    ```
    
- **cylinder**
    
    원기둥. 길이와 반지름을 정의
    
    ```
    <cylinder length="0.6" radius="0.2"/>
    ```
    
- **sphere**
    
    구. 반지름 정의
    
    ```
    <sphere radius="0.2"/> 
    ```
    
- **mesh**
    
    외부 3D 모델을 불러와서 사용
    
    ```
    <mesh filename="package://meshes/example.stl"/>
    ```
<br>

**재질(material)**

링크의 색상이나 질감을 정의하는 태그이다.

- **color**
    
    rgba 형식으로 색상을 정의(0.0~1.0, 마지막 a는 투명도)
    
    ```
    <color rgba="1.0 1.0 .0. 1.0"/>
    ```
    
- **texture**
    
    외부 이미지 파일(PNG, JPG 등)을 부러와서 질감을 입힘
    
    ```
    <texture filename="package:://textures/example.png"/>
    ```
<br>    

**물리적 속성(inertial)**

강체의 물리적 속성은 아래 하위 태그 세 가지로 표현된다:

- **origin**: 질량 중심 위치
- **mass**: 질량 값(단위는 킬로그램)
- **inertia**: 3x3 회전 관성 행렬. 대칭으로써 아래 괄호 부분만 정의한다.
    
    ```
    (ixx) (ixy) (ixz)
    
     ixy  (iyy) (iyz)
    
     ixz   iyz  (izz)
    ```
<br>    

**시각적 속성(visual)**

시각적 속성은 아래 하위 태그 두 가지로 표현된다:

- **origin**
- **geometry**
- **material**<br><br>

**충돌 속성(collision)**

로봇이 벽이나 다른 물체와 충돌하면 더 이상 움직이지 못하거나 그에 맞는 행동을 해야하는데, 이를 위해 충돌 속석을 정의해준다.

충돌 속성은 아래 하위 태그 두 가지로 표현된다:

- **origin**
- **geometry**
<br><br>

---

### Joint

조인트는 동적인 움직임을 위해 링크와 링크를 연결하는 연결부이며, 두 링크를 어떻게 연결할지를 정의한다.<br><br>

**타입 종류**

조인트는 여섯 가지 타입을 가지는데, 상황에 맞게 골라서 사용하면 된다.

아래 여섯 가지의 타입을 가진다:

- **고정 관절 (fixed joint)**: 움직이지 않도록 고정하여 연결.
- **회전 관절 (revolute joint)**: 한 축을 중심으로 일정 각도 범위를 회전. (일정 각도 회전하는 선풍기의 좌우회전)
- **연속 회전 (continuous joint)**: 한 축을 중심으로 무제한 회전. 각도 제한이 없다. (바퀴, 프로펠러)
- **프리즘 관절 (prismatic joint)**: 한 축을 따라 일정 범위만큼 직선 이동.
- **평면 관절 (planar joint)**: 2차원 평면(2자유도 이동 + 1자유도 회전)에서 이동 및 회전 (2D 시뮬레이션 환경)
- **자유 관절 (floating joint)**: 6차원(직교 좌표계 3차원, 오일러 각 3차원) 이동 및 회전 (공중에 떠있는 드론)

대부분 사용하는 관절은 고정 관절(fixed joint), 횐전 관절(revolute), 연속 회전(continuous joint)이다.<br><br>

**조인트의 속성**

조인트도 링크와 같이 여러 속성을 가지는데, 링크와 달리 조인트는 필수 입력 속성도 가진다.

아래의 세 가지는 조인트의 필수 입력 속성이다:

- **parent**: 부모 링크 이름
- **child**: 자식 링크 이름
- **axis**: 조인트의 축을 표현 (타입이 revolute, continuous, prismatic일 경우에만 필수 입력)

아래 세 개는 조인트의 옵션 입력 속성이다:

- **origin**: 좌표계 위치/자세(부모 링크 기준)를 정의. 사용하지 않아도 디폴트로 좌표계의 원점(0,0,0, 회전 없음)에 조인트가 놓인다.
- **dynamics**: 조인트의 물리적 동역학 특성을 설정한다.
- **limit**: 움직임 제한 (revolute joint와 prismatic joint에서만 정의 가능)